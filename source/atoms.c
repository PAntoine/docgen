/*--------------------------------------------------------------------------------*
 * Name: Parser Look-up tree
 * Desc: function and data structures to speed up a specific string search
 *
 *         **** DO NOT AMEND THIS CODE - IT IS AUTO_GENERATED ****
 *
 * Code and table produced by:
 *            build_graph 
 *            version 0.8
 *
 *  written by Peter Antoine. 
 *
 *   **** This code can be used however you like, no claims whatsoever are ****
 *   **** placed on the auto-generated code or data, or on the code that   ****
 *   **** uses the that code or data.                                      ****
 *   **** Or, to paraphrase "Fill your boots".                             ****
 *--------------------------------------------------------------------------------*/

#include "atoms.h"

ATOMS_STRING_TABLE	atoms_table[42] = {
		{"activation",10},
		{"after",5},
		{"api",3},
		{"author",6},
		{"brief",5},
		{"call",4},
		{"condition",9},
		{"copyright",9},
		{"defines",7},
		{"end_define",10},
		{"examples",8},
		{"file",4},
		{"function",8},
		{"group",5},
		{"ignore",6},
		{"licence",7},
		{"message",7},
		{"name",4},
		{"next",4},
		{"option",6},
		{"parameter",9},
		{"record",6},
		{"repeats",7},
		{"responds",8},
		{"returns",7},
		{"see_also",8},
		{"send",4},
		{"state",5},
		{"synopsis",8},
		{"timeline",8},
		{"to",2},
		{"trigger",7},
		{"triggers",8},
		{"type",4},
		{"waitfor",7},
		{"entry",5},
		{"action",6},
		{"desc",4},
		{"description",11},
		{"prototype",9},
		{"parameters",10},
		{"zzzz",4}
};

static signed char	symbol_table[256] = 
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x14,
	 0x00,0x01,0x0E,0x02,0x10,0x09,0x08,0x12,0x0D,0x04,0x00,0x00,0x0F,0x16,0x07,0x06,
	 0x0B,0x00,0x0A,0x13,0x03,0x0C,0x05,0x17,0x15,0x11,0x18,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

typedef struct
{	unsigned char	mask;
	unsigned char	table;
} LOOKUP_TABLE;

static LOOKUP_TABLE	state_table[38] = {
	{ 0, 0},{ 1, 1},{ 2, 1},{ 3, 1},{ 4, 1},{ 5, 2},{ 6, 2},{ 7, 1},{ 8, 2},{ 9, 1},{10, 2},{11, 2},{12, 3},{13, 1},{14, 2},{15, 4},
	{16, 1},{ 7, 2},{17, 3},{ 7, 4},{14, 3},{18, 0},{19, 3},{ 7, 5},{20, 4},{21, 6},{22, 7},{23, 4},{ 2, 3},{24, 1},{24, 2},{ 7, 8},
	{14, 5},{18, 0},{19, 5},{25, 2},{18, 0},{26, 6}};

static unsigned int mask_table[27] = {
	0x00cdcfde,0x00000009,0x00000010,0x00000060,0x00001904,0x00000042,0x00000880,0x00000200,
	0x00080100,0x00200080,0x00010008,0x00001010,0x00000202,0x00000402,0x00000400,0x00000002,
	0x00400000,0x00000008,0x00000000,0x00080001,0x0008080c,0x00020208,0x00000280,0x00020450,
	0x00040000,0x00000004,0x00000401};

static unsigned char table[9][24] = {
	{0x00,0x04,0x05,0x1b,0xf1,0x00,0xec,0x0c,0x0b,0x09,0x17,0x0d,0x00,0x00,0xfb,0xf0,0x07,0x00,0xf2,0x19,0x00,0x00,0xef,0xdd},
	{0xd6,0x0e,0x01,0x02,0x03,0xff,0xdb,0x0a,0xfe,0x08,0xd8,0xfd,0xfc,0x00,0x00,0x00,0x00,0x00,0x1e,0x00,0x00,0xf5,0x11,0x00},
	{0x00,0xfa,0x25,0xdc,0xf4,0x00,0x06,0xf9,0xf7,0x12,0x0f,0xf8,0xf3,0x00,0x00,0x00,0xf6,0x00,0x1f,0x23,0x00,0x00,0x00,0x00},
	{0xeb,0xee,0x00,0x13,0x1d,0x00,0x00,0x00,0x00,0xed,0x16,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xd7,0x00,0x00,0x00,0x00},
	{0x00,0x10,0xea,0xe7,0xe2,0x00,0xe1,0x00,0x00,0x14,0x1c,0xe9,0x00,0x00,0x00,0x00,0x00,0xde,0x00,0xe8,0x00,0x00,0x00,0x00},
	{0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x22,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xdf,0x00,0x00,0x00,0x00},
	{0xda,0x00,0x00,0xe4,0x00,0x00,0x00,0x00,0x00,0x1a,0xd9,0x00,0x00,0x00,0x00,0x00,0x00,0xe3,0x00,0x00,0x00,0x00,0x00,0x00},
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xe5,0x00,0xe6,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}};

unsigned int atoms_get_length(int word)
{
	return atoms_table[word].length;
}

int	atoms_check_word(unsigned char* word)
{
	signed char		line = 0;
	unsigned int	symbol = 0;
	unsigned int	count = 0;
	unsigned int	letter = 0;
	unsigned int	symbol_bit;

	do
	{
		symbol = symbol_table[word[letter]];
		symbol_bit = (0x1 << (symbol & 0x1F));

		if ((mask_table[state_table[line].mask] & symbol_bit) == 0)
		{
			/* bad symbol for line */
			line = 0;
		}
		else
		{
			line = (signed char) table[state_table[line].table][symbol];
		}
		letter++;

	}
	while (line > 0);

	symbol_bit = (0x1 << (symbol_table[word[letter]] & 0x1F));

	if (line < 0)
		line = (0-line) - 1;
	else if (((mask_table[state_table[line].mask] & symbol_bit) != 0) && ((line = (signed char) table[state_table[line].table][symbol_table[0]]) < 0))
		line = (0-line) - 1;
	else
		line = -1;
	if (line >= 0)
	{
		for (count=letter;count < atoms_table[line].length;count++)
		{
			if (word[count] != atoms_table[line].name[count])
			{
				line = -1;
				break;
			}
		}
	}
	return line;
}
